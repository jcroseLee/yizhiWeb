# 易知 - 六爻占卜 Web 平台产品需求文档 (PRD)

**版本**: v1.0  
**日期**: 2025-01-27  
**产品名称**: 易知  
**产品定位**: 专业的六爻占卜 Web 平台

---

## 1. 产品概述

### 1.1 产品定位
易知是一个基于传统六爻占卜理论的现代化 Web 平台，旨在为用户提供专业的占卜服务、易学知识分享和实证案例学习。平台采用新中式学术风格设计，结合现代 Web 技术，打造沉浸式的易学体验。

### 1.2 目标用户
- **主要用户**: 对易学、占卜感兴趣的爱好者
- **次要用户**: 易学研究者、咨询师、学习者
- **潜在用户**: 寻求决策参考的普通用户

### 1.3 核心价值
- **专业性**: 基于传统六爻理论，提供准确的排盘和解读
- **易用性**: 现代化的交互设计，降低使用门槛
- **社区化**: 构建易学爱好者交流学习的平台
- **实证性**: 通过案例验证，提升占卜的可信度

---

## 2. 功能模块

### 2.1 六爻占卜模块

#### 2.1.1 起卦功能
**功能描述**: 提供三种起卦方式，满足不同用户需求

**功能点**:
1. **手动摇卦**
   - 用户通过点击按钮模拟摇卦过程
   - 每次摇卦显示硬币正反面
   - 记录六次摇卦结果

2. **自动摇卦**
   - 系统自动生成六次摇卦结果
   - 快速起卦，适合快速查询

3. **手工指定**
   - 用户手动选择每一爻的状态（阴/阳、动/静）
   - 适合有经验的用户精确控制

**输入项**:
- 求测事项（必填，文本输入）
- 起卦时间（可选，默认当前时间）
- 起卦方式（必选，三选一）

**输出项**:
- 本卦卦象及卦名
- 变卦卦象及卦名
- 动爻标识
- 四柱干支信息
- 农历日期及节气
- 空亡信息
- 六爻详细信息（六亲、世应、五行等）

#### 2.1.2 排盘结果展示
**功能描述**: 以传统排盘书的形式展示占卜结果

**展示内容**:
1. **头部信息**
   - 所占事项标题
   - 公历时间
   - 农历日期及节气
   - 起卦方式
   - 四柱干支（年、月、日、时）

2. **卦象展示**
   - 本卦：完整六爻显示，包含：
     - 爻位（初爻至六爻）
     - 阴阳属性
     - 动爻标记（红色高亮）
     - 六亲关系（父母、兄弟、子孙、妻财、官鬼）
     - 世应标记
     - 地支五行
   - 变卦：显示变后的卦象
   - 动爻变化提示

3. **卦辞解读**
   - 本卦卦辞
   - 变卦卦辞
   - 动爻说明

**交互功能**:
- 保存到云端
- 分享结果图
- 导出排盘数据
- 查阅古籍原文
- AI 智能详批（付费功能）

#### 2.1.3 历史记录
**功能描述**: 保存用户的占卜历史记录

**功能点**:
- 本地存储占卜结果列表
- 支持查看历史记录详情
- 支持删除历史记录
- 支持搜索历史记录

---

### 2.2 用户系统模块

#### 2.2.1 注册登录
**功能描述**: 用户账户注册和登录功能

**注册功能**:
- 邮箱注册
- 密码设置（需符合安全要求）
- 邮箱验证（可选）

**登录功能**:
- 邮箱密码登录
- 忘记密码功能
- 记住登录状态

**UI 设计**:
- 星空背景动画
- 玻璃拟态卡片设计
- 登录/注册模式切换

#### 2.2.2 个人资料
**功能描述**: 用户个人信息管理

**资料项**:
- 昵称
- 头像（支持上传）
- 个人简介/座右铭
- 用户等级
- 认证状态

**功能点**:
- 编辑个人资料
- 上传头像
- 查看个人统计

#### 2.2.3 学术看板
**功能描述**: 展示用户的学术成就和统计数据

**统计指标**:
- 发布案例数
- 参与推演数
- 获赞同数
- 准确率（基于已验证案例）

---

### 2.3 社区模块

#### 2.3.1 频道分类
**功能描述**: 社区内容按频道分类展示

**频道类型**:
1. **推荐**: 算法推荐的热门内容
2. **论道**: 理论探讨和知识分享
3. **悬卦**: 求助帖，可设置悬赏
4. **争鸣**: 争议话题和热点讨论
5. **茶寮**: 闲聊和日常交流

#### 2.3.2 帖子功能
**功能描述**: 用户发布和浏览帖子

**帖子类型**:
- 普通帖子（文字、图片）
- 带卦象的帖子（包含排盘结果）
- 悬赏帖子（设置易币悬赏）

**帖子信息**:
- 标题
- 正文内容
- 标签
- 作者信息（昵称、头像、等级、认证状态）
- 统计数据（点赞、评论、浏览）
- 发布时间
- 卦象信息（如有）

**交互功能**:
- 发布帖子
- 点赞
- 评论
- 收藏
- 分享
- 举报

#### 2.3.3 侧边栏功能
**功能描述**: 社区页面右侧辅助功能

**功能模块**:
1. **今日运势卡片**
   - 显示用户今日运势
   - 宜忌事项

2. **用户信息卡片**
   - 当前登录用户信息
   - 快速操作入口

3. **论道风向标**
   - 热门话题
   - 趋势标签

4. **工具栏**
   - 在线排盘入口
   - 古籍查询入口

---

### 2.4 案例库模块

#### 2.4.1 案例展示
**功能描述**: 展示用户发布的实证案例

**案例信息**:
- 求测事项
- 背景描述
- 卦象信息（卦名、爻线、动爻）
- 作者信息
- 验证状态（验·准、验·错、待验）
- 统计数据（浏览、评论、收藏）
- 发布时间
- 标签

#### 2.4.2 筛选功能
**功能描述**: 多维度筛选案例

**筛选维度**:
1. **分类筛选**
   - 事业
   - 感情
   - 财运
   - 健康
   - 其他

2. **验证状态**
   - 已验证（准）
   - 已验证（错）
   - 待验证

3. **卦型筛选**
   - 六冲卦
   - 六合卦
   - 静卦
   - 其他

4. **起卦方式**
   - 手动摇卦
   - 自动摇卦
   - 手工指定

5. **其他选项**
   - 仅显示认证用户
   - 仅显示关注用户

#### 2.4.3 案例详情
**功能描述**: 查看案例的详细信息

**详情内容**:
- 完整的排盘结果
- 背景描述
- 后续反馈
- 评论讨论
- 相关案例推荐

---

### 2.5 个人中心模块

#### 2.5.1 我的笔记本
**功能描述**: 用户保存的占卜记录和笔记

**功能点**:
- 查看笔记列表
- 搜索笔记
- 新建笔记
- 编辑笔记
- 删除笔记
- 笔记详情查看

**笔记信息**:
- 标题
- 描述
- 创建时间
- 关联的占卜结果

#### 2.5.2 我的服务
**功能描述**: 咨询师服务管理（开发中）

**规划功能**:
- 服务设置
- 订单管理
- 收益统计

---

### 2.6 其他功能模块

#### 2.6.1 咨询师页面
**状态**: 开发中

**规划功能**:
- 咨询师列表
- 咨询师详情
- 预约咨询
- 评价系统

#### 2.6.2 消息功能
**状态**: 开发中

**规划功能**:
- 私信功能
- 系统通知
- 评论回复通知
- 点赞通知

#### 2.6.3 AI 智能详批
**功能描述**: 基于 AI 的深度卦象解读

**功能点**:
- 基于《增删卜易》古法
- 结合大模型推理
- 解析吉凶应期
- 付费功能

---

## 3. 技术架构

### 3.1 前端技术栈
- **框架**: Next.js 16 (App Router)
- **语言**: TypeScript
- **样式**: Tailwind CSS 4
- **UI 组件**: shadcn/ui (基于 Radix UI)
- **状态管理**: Zustand
- **富文本编辑器**: Tiptap
- **图表**: Recharts
- **日期处理**: Day.js, date-fns
- **易学算法**: lunar-javascript
- **动画**: Framer Motion, GSAP

### 3.2 后端技术栈
- **BaaS**: Supabase
  - PostgreSQL 数据库
  - 认证服务
  - 存储服务
  - 实时订阅

### 3.3 核心算法
- 六十四卦计算
- 四柱干支计算
- 农历日期转换
- 节气计算
- 空亡计算
- 六亲、世应计算

---

## 4. UI/UX 设计规范

### 4.1 设计主题
**新中式学术风格**

### 4.2 色彩系统
- **主色**: 朱砂红 (#C82E31) - 用于强调和激活状态
- **背景**: 宣纸白 (#fdfbf7, #f5f5f7) - 主背景色
- **文字**: 墨色 (#2C3E50, #1a1a1a) - 主要文字
- **辅助色**: 浅米色、墨蓝、朱砂红

### 4.3 字体系统
- **标题**: 思源宋体（Serif）
- **正文**: 思源黑体（Sans-serif）
- **代码/数据**: 等宽字体（Mono）

### 4.4 设计元素
- **宣纸纹理**: 背景使用微妙的纹理效果
- **印章样式**: 用于标签和状态标识
- **毛笔笔触**: 下划线等装饰元素
- **传统排版**: 竖排文本、传统排版风格

### 4.5 交互设计
- **动画**: 平滑过渡，使用 Framer Motion
- **反馈**: 明确的视觉反馈
- **响应式**: 支持桌面端和移动端适配

---

## 5. 数据模型

### 5.1 用户表 (profiles)
- id (UUID, Primary Key)
- user_id (UUID, Foreign Key to auth.users)
- nickname (String)
- avatar_url (String)
- motto (String)
- level (Integer)
- is_verified (Boolean)
- created_at (Timestamp)
- updated_at (Timestamp)

### 5.2 占卜记录表 (divinations)
- id (UUID, Primary Key)
- user_id (UUID, Foreign Key)
- question (String)
- divination_time (Timestamp)
- divination_method (Integer)
- lines (JSON)
- changing_flags (JSON)
- result (JSON)
- created_at (Timestamp)

### 5.3 笔记表 (notes)
- id (UUID, Primary Key)
- user_id (UUID, Foreign Key)
- title (String)
- description (Text)
- divination_id (UUID, Foreign Key, Nullable)
- created_at (Timestamp)
- updated_at (Timestamp)

### 5.4 帖子表 (posts)
- id (UUID, Primary Key)
- user_id (UUID, Foreign Key)
- type (String) - 频道类型
- title (String)
- content (Text)
- tags (JSON)
- gua_data (JSON, Nullable)
- bounty (Integer, Default 0)
- stats (JSON) - 点赞、评论、浏览数
- created_at (Timestamp)
- updated_at (Timestamp)

### 5.5 案例表 (cases)
- id (UUID, Primary Key)
- user_id (UUID, Foreign Key)
- question (String)
- background (Text)
- gua_data (JSON)
- feedback (JSON) - 验证状态和反馈
- stats (JSON)
- tags (JSON)
- created_at (Timestamp)
- updated_at (Timestamp)

---

## 6. 功能优先级

### 6.1 P0 (核心功能，必须实现)
- ✅ 六爻占卜功能（起卦、排盘、结果展示）
- ✅ 用户注册登录
- ✅ 个人资料管理
- ✅ 占卜历史记录（本地存储）

### 6.2 P1 (重要功能，优先实现)
- ✅ 社区模块（帖子发布、浏览）
- ✅ 案例库（案例展示、筛选）
- ✅ 个人中心（笔记本、学术看板）
- ⏳ 云端存储占卜记录

### 6.2 P2 (次要功能，后续实现)
- ⏳ 咨询师功能
- ⏳ 消息功能
- ⏳ AI 智能详批
- ⏳ 支付功能
- ⏳ 分享功能优化

---

## 7. 非功能性需求

### 7.1 性能要求
- 页面加载时间 < 2秒
- 占卜计算响应时间 < 500ms
- 支持并发用户数 > 1000

### 7.2 兼容性要求
- 现代浏览器（Chrome, Firefox, Safari, Edge）
- 响应式设计，支持移动端访问
- 最低分辨率: 1280x720

### 7.3 安全性要求
- 用户数据加密存储
- HTTPS 传输
- 防止 XSS、CSRF 攻击
- 用户认证使用 Supabase Auth

### 7.4 可维护性要求
- 代码模块化
- TypeScript 类型安全
- 组件可复用
- 文档完善

---

## 8. 未来规划

### 8.1 短期规划（3个月）
- 完善社区功能
- 实现消息系统
- 优化移动端体验
- 增加更多占卜方式

### 8.2 中期规划（6个月）
- 咨询师平台上线
- AI 解读功能优化
- 支付系统集成
- 数据分析和可视化

### 8.3 长期规划（12个月）
- 移动端 App 开发
- 国际化支持
- 开放 API
- 易学知识库建设

---

## 9. 附录

### 9.1 术语表
- **六爻**: 传统占卜方法，通过六个爻位组成卦象
- **本卦**: 初始起出的卦象
- **变卦**: 动爻变化后形成的卦象
- **动爻**: 发生变化的爻位
- **四柱**: 年、月、日、时的干支组合
- **六亲**: 父母、兄弟、子孙、妻财、官鬼
- **世应**: 卦中的世爻和应爻

### 9.2 参考资料
- 《增删卜易》
- 《周易》
- 传统六爻理论

---

**文档维护**: 本文档将随产品迭代持续更新  
**最后更新**: 2025-01-27

